#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PYTHONPATH_VALUE="${ROOT_DIR}/src"
if [[ -n "${PYTHONPATH:-}" ]]; then
  PYTHONPATH_VALUE="${PYTHONPATH_VALUE}:${PYTHONPATH}"
fi

if [[ "${1:-}" == "" ]]; then
  cat <<'EOF'
Usage: ./scout <aiedge-args...>

Examples
  ./scout tui                  # latest run, auto mode
  ./scout tui -w               # latest run, watch mode
  ./scout tui -i               # latest run, interactive mode
  ./scout ti                   # alias: tui -i
  ./scout tw                   # alias: tui -w
  ./scout tui aiedge-runs/<run_id> -w -t 2 -n 20
  ./scout run firmware.bin --profile exploit
  ./scout report aiedge-runs/<run_id>
EOF
  exit 0
fi

case "${1:-}" in
  ti)
    shift
    set -- tui -i "$@"
    ;;
  tw)
    shift
    set -- tui -w "$@"
    ;;
  to)
    shift
    set -- tui -m once "$@"
    ;;
esac

exec env PYTHONPATH="${PYTHONPATH_VALUE}" python3 -m aiedge "$@"
